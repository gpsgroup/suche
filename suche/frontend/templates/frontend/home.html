{% extends "pages/__base.html" %}
{% load staticfiles %}

{% block body %}
   
    <div class="row" id="bg" style="padding-bottom: 20px">
        <div class="container text-center" >
        <!--logo -->
            <div class="row text-center">
             
                <div class="row text-center">
                <div class="col-md-12 text-center" id="logo">
                <img  src="{% static 'images/logo.png' %}" class="img-responsive" style="margin: 0 auto;" id="logo1"/>       
                </div>
                </div>
                <form class="row" id="search_form" action="/" method="GET">
                    <div class="input-group">
                      <div class="input-group-addon"><span class="glyphicon glyphicon-search"></span></div>
                      <input type="text" class="form-control" placeholder="Search Query" id="search" name = "q" style="height:50px" onkeyup = "startcompletion()" value="{{ query }}"/>
                      <div class="input-group-btn"><input type="submit" value="Search" class="btn btn-primary" style="height:50px; width:100px" id="submitBtn"></div>
                    </div>
                </form>

{% if query %}<br/><br/><p>Showing result for &quot;<strong>{{ correctedquery }} </strong> &quot;{% if correctedquery != query  %} Show instead for &quot;<strong> {{ query }} {% endif %}</strong>&quot;</p><br>Parsed:<b>{{parsedquery}}</b>{% endif %}

            </div>
    </div>
    </div>
    
    <div class="container text-left" style="padding-top: 10px" id="searchResult">
       
    </div>

<script>
var state=0;
$(function(){
    
   $('#search').focus(); 
});

function startcompletion() {
    var search = $('#search').val()
    var data = {
        search: search
    };
    $.ajax({
        url: '/autocomplete',
        data: data,
        dataType: 'jsonp',
        jsonp: 'callback',
        jsonpCallback: 'autocomplete'
    });
}


function autocomplete(data) {
console.log("here");
    $( "#search" ).autocomplete ({
        source: data
    });
}

$(function() {
$('#search_form').submit(function(event) {
    // we have to load the search result with ajax later
//this function will slide the division "topspace" up and 
//display the result.
    event.preventDefault();
    
    var vall=$('#search').val();
    if (vall!="" && state==0) {
        //code
          $( "#search" ).autocomplete ("close");  
          $('#logo').animate({
              "width":"300px",
              
           
          },"slow");
          //animate textbox
          $('#search').animate({"height":"40px"},"slow");
          $('.input-group-addon').animate({"opacity":"0"},"slow");
          $('#submitBtn').animate({"height":"40px"},"slow");
          
          //animate bg color
          $('#bg').animate({
                 "backgroundColor":"#eee",
                 "left":"0px"
              
          },"slow");
          $('#logo1').css({"margin": "0 auto" } );
          state=1;
          
        
    }
    if (vall!="") {
        //code
        $.get("/search?q="+encodeURIComponent(vall),function(op){
               $("#searchResult").html("");
               $("#searchResult").fadeOut("slow",function()
                                          {
                                            $("#searchResult").html(op).fadeIn("slow");
                                          }
                                          );
               
               
               
               
            });
        
    }

});
//to restore on empty


});

</script>
{% endblock body %}
